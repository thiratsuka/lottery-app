<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fundiæŠ½é¸ã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <header>
        <h1>ğŸ¯ fundiæŠ½é¸ã‚¢ãƒ—ãƒª</h1>
    </header>
    <main>
        <!-- æŠ½é¸ãƒ•ã‚©ãƒ¼ãƒ  -->
        <section id="æŠ½é¸">
            <h2>æŠ½é¸è¨­å®š</h2>
            <form id="lottery-form">
                <label for="csv-file">CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰:</label>
                <input type="file" id="csv-file" accept=".csv" required>
                <br><br>
                <label for="budget">æŠ½é¸äºˆç®—é‡‘é¡:</label>
                <input type="number" id="budget" name="budget" min="1" required>
                <br><br>
                <label for="exclude">é™¤å¤–ã™ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ (ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š):</label>
                <input type="text" id="exclude" name="exclude" placeholder="ä¾‹: sample1@example.com, sample2@example.com">
                <br><br>
                <button type="button" onclick="submitForm()">æŠ½é¸é–‹å§‹</button>
            </form>
            <div id="result">
                <!-- æŠ½é¸çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 fundi All Rights Reserved.</p>
    </footer>

    <script>
        function submitForm() {
            const fileInput = document.getElementById("csv-file");
            const budget = parseInt(document.getElementById("budget").value, 10);
            const excludeInput = document.getElementById("exclude").value;

            if (!fileInput.files[0]) {
                alert("CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            const excludeList = excludeInput.split(",").map(email => email.trim());

            const reader = new FileReader();
            reader.onload = function(event) {
                const csvData = event.target.result;
                const rows = csvData.split("\n").map(row => row.split(","));
                const [header, ...data] = rows;

                if (!header.includes("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹") || !header.includes("é‡‘é¡")) {
                    document.getElementById("result").innerHTML = "<p>CSVã« 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹' ã¨ 'é‡‘é¡' åˆ—ãŒå¿…è¦ã§ã™ã€‚</p>";
                    return;
                }

                const emailIndex = header.indexOf("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹");
                const amountIndex = header.indexOf("é‡‘é¡");

                const validData = data.filter(row => !excludeList.includes(row[emailIndex]));

                let remainingBudget = budget;
                const selected = [];

                validData.forEach(row => {
                    const email = row[emailIndex];
                    const amount = parseInt(row[amountIndex], 10);
                    if (amount <= remainingBudget) {
                        selected.push({ email, amount });
                        remainingBudget -= amount;
                    }
                });

                // çµæœã‚’è¡¨ç¤º
                let resultHtml = `<p>æŠ½é¸çµæœ: ${selected.length}åãŒå½“é¸ã—ã¾ã—ãŸï¼</p><ul>`;
                selected.forEach(item => {
                    resultHtml += `<li>${item.email} - ${item.amount}å††</li>`;
                });
                resultHtml += `</ul><p>æ®‹ã‚Šäºˆç®—: ${remainingBudget}å††</p>`;
                document.getElementById("result").innerHTML = resultHtml;
            };

            reader.readAsText(fileInput.files[0]);
        }
    </script>
</body>
</html>
